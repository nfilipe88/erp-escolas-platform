<div class="max-w-5xl mx-auto mt-10 p-6">

  <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-lg shadow border border-gray-200">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">SituaÃ§Ã£o Financeira</h1>
      <p class="text-gray-500" *ngIf="aluno">Aluno: <span class="font-bold text-blue-900">{{ aluno.nome }}</span></p>
    </div>
    <div class="text-right">
      <div class="text-sm font-bold text-gray-400">Ano Letivo</div>
      <div class="text-3xl font-bold text-blue-600">2025</div>
    </div>
  </div>

  <div *ngIf="mensalidades.length === 0"
    class="text-center py-20 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
    <div class="text-5xl mb-4">ğŸ“‚</div>
    <p class="text-gray-600 mb-6">Este aluno ainda nÃ£o tem plano financeiro gerado para 2025.</p>
    <button (click)="gerarCarnet()"
      class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded shadow-lg transition transform hover:scale-105">
      ğŸš€ Gerar Carnet de Propinas
    </button>
  </div>

  <div *ngIf="mensalidades.length > 0" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">

    @for (m of mensalidades; track m.id) {
    <div (click)="selecionarParaPagar(m)"
      class="relative p-5 rounded-lg border-2 cursor-pointer transition-all duration-200 shadow-sm hover:shadow-md"
      [ngClass]="{
          'border-red-200 bg-red-50 hover:border-red-400': m.estado === 'Pendente',
          'border-green-200 bg-green-50': m.estado === 'Pago'
        }">

      <div class="flex justify-between items-start mb-2">
        <h3 class="font-bold text-lg" [ngClass]="m.estado === 'Pago' ? 'text-green-800' : 'text-red-800'">
          {{ m.mes }}
        </h3>
        <button *ngIf="m.estado === 'Pago'"
                  [routerLink]="['/recibo', m.id]"
                  class="bg-white text-blue-600 hover:bg-blue-50 border border-blue-200 p-1.5 rounded-full transition shadow-sm"
                  title="Imprimir Recibo"
                  (click)="$event.stopPropagation()"> ğŸ–¨ï¸
          </button>
        <span class="text-xs font-bold px-2 py-1 rounded uppercase"
          [ngClass]="m.estado === 'Pago' ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'">
          {{ m.estado }}
        </span>
      </div>

      <p class="text-2xl font-bold text-gray-700">{{ m.valor_base | currency:'AKZ ':'symbol':'1.0-0' }}</p>

      <div *ngIf="m.estado === 'Pago'" class="mt-2 text-xs text-green-700 border-t border-green-200 pt-2">
        Pago em: {{ m.data_pagamento | date:'dd/MM' }}<br>
        Via: {{ m.forma_pagamento }}
      </div>

      <div *ngIf="m.estado === 'Pendente'" class="mt-2 text-xs text-red-400 italic">
        Clique para pagar
      </div>

    </div>
    }

  </div>
</div>

<div *ngIf="mensalidadeSelecionada" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity duration-300">

  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100">

    <div class="bg-blue-900 p-4 text-center">
      <h3 class="text-white text-lg font-bold uppercase tracking-wide">Confirmar Pagamento</h3>
      <p class="text-blue-200 text-sm mt-1">{{ mensalidadeSelecionada.mes }} / {{ mensalidadeSelecionada.ano }}</p>
    </div>

    <div class="p-8 text-center">
      <p class="text-gray-500 mb-2">Valor a regularizar:</p>
      <div class="text-4xl font-extrabold text-gray-800 mb-8">
        {{ mensalidadeSelecionada.valor_base | currency:'AKZ ':'symbol':'1.0-0' }}
      </div>

      <p class="text-sm text-gray-400 mb-4 font-medium">Selecione o mÃ©todo de pagamento:</p>

      <div class="grid grid-cols-2 gap-4">
        <button (click)="confirmarPagamento('TPA')"
          class="flex flex-col items-center justify-center p-4 border-2 border-blue-100 rounded-xl hover:bg-blue-50 hover:border-blue-500 transition group cursor-pointer">
          <span class="text-2xl mb-2 group-hover:scale-110 transition">ğŸ’³</span>
          <span class="font-bold text-blue-800 text-sm">TPA / Multicaixa</span>
        </button>

        <button (click)="confirmarPagamento('NumerÃ¡rio')"
          class="flex flex-col items-center justify-center p-4 border-2 border-green-100 rounded-xl hover:bg-green-50 hover:border-green-500 transition group cursor-pointer">
          <span class="text-2xl mb-2 group-hover:scale-110 transition">ğŸ’µ</span>
          <span class="font-bold text-green-800 text-sm">Dinheiro / Cash</span>
        </button>
      </div>
    </div>

    <div class="bg-gray-50 p-4 text-center border-t border-gray-100">
      <button (click)="mensalidadeSelecionada = null" class="text-gray-500 hover:text-red-500 font-medium text-sm transition">
        Cancelar e Voltar
      </button>
    </div>

  </div>
</div>
