<div
  class="max-w-4xl mx-auto mt-10 p-8 bg-white shadow-2xl rounded-sm border border-gray-300 print:shadow-none print:border-0 print:w-full print:max-w-none">

  <div class="text-center border-b-2 border-black pb-4 mb-6">
    <h1 class="text-3xl font-bold uppercase tracking-widest text-gray-900">Boletim Escolar</h1>
    <p class="text-gray-500">Ano Letivo 2025</p>
  </div>

  <div *ngIf="boletim; else loading">
    <div class="flex justify-between mb-8 text-sm uppercase">
      <div>
        <p><span class="font-bold">Aluno:</span> {{ boletim.aluno_nome }}</p>
        <p><span class="font-bold">BI:</span> {{ boletim.aluno_bi || '---' }}</p>
      </div>
      <div class="text-right">
        <p><span class="font-bold">Turma:</span> {{ boletim.turma }}</p>
        <p><span class="font-bold">Data:</span> {{ dataHoje | date:'dd/MM/yyyy' }}</p>
      </div>
    </div>

    <table class="w-full border-collapse border border-black text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="border border-black p-3 text-left w-1/3">Disciplina</th>
          <th class="border border-black p-3 text-center">1Âº Trimestre</th>
          <th class="border border-black p-3 text-center">2Âº Trimestre</th>
          <th class="border border-black p-3 text-center">3Âº Trimestre</th>
          <th class="border border-black p-3 text-center bg-gray-200">MÃ©dia</th>
        </tr>
      </thead>
      <tbody>
        <!-- REMOVER o operador opicional aqui, pois jÃ¡ temos *ngIf="boletim" -->
        <tr *ngFor="let linha of boletim.linhas">
          <td class="border border-black p-3 font-bold">{{ linha.disciplina }}</td>

          <!-- Usa a funÃ§Ã£o getNota para cada trimestre -->
          <td *ngFor="let trimestre of ['1Âº Trimestre', '2Âº Trimestre', '3Âº Trimestre']"
            class="border border-black p-3 text-center">
            {{ getNota(linha.notas, trimestre) }}
          </td>

          <td class="border border-black p-3 text-center font-bold bg-gray-50">
            {{ linha.media_provisoria | number:'1.1-1' }}
          </td>
        </tr>

        <!-- Linha de totais (opcional) -->
        <!-- REMOVER o operador opcional aqui tambÃ©m -->
        <tr *ngIf="boletim.linhas.length" class="bg-gray-100">
          <td class="border border-black p-3 font-bold">MÃ‰DIA GERAL</td>
          <td colspan="3" class="border border-black p-3 text-center">
            MÃ©dia de {{ boletim.linhas.length }} disciplinas
          </td>
          <td class="border border-black p-3 text-center font-bold">
            {{ calcularMediaGeral() | number:'1.1-1' }}
          </td>
        </tr>
      </tbody>
    </table>

    <div class="mt-16 pt-8 grid grid-cols-2 gap-10 text-center">
      <div>
        <div class="border-b border-gray-400 w-3/4 mx-auto mb-2"></div>
        <p class="text-sm font-bold text-gray-600">Assinatura do Diretor de Turma</p>
      </div>
      <div>
        <div class="border-b border-gray-400 w-3/4 mx-auto mb-2"></div>
        <p class="text-sm font-bold text-gray-600">Assinatura do Encarregado de EducaÃ§Ã£o</p>
      </div>
    </div>

    <div class="mt-12 flex justify-between items-end print:hidden">
      <a routerLink="/lista-alunos" class="text-blue-600 hover:underline">â† Voltar Ã  Lista</a>
      <button (click)="imprimir()" class="bg-black text-white px-6 py-2 rounded hover:bg-gray-800">
        ğŸ–¨ï¸ Imprimir Boletim
      </button>
    </div>
  </div>

  <ng-template #loading>
    <p class="text-center py-10">A carregar boletim...</p>
  </ng-template>
</div>
