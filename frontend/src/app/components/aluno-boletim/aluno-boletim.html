<div class="max-w-4xl mx-auto mt-10 p-8 bg-white shadow-2xl rounded-sm border border-gray-300 print:shadow-none print:border-0 print:w-full print:max-w-none">

  <div class="text-center border-b-2 border-black pb-4 mb-6">
    <div class="flex justify-center mb-2">
      <span class="text-4xl">ğŸ“</span>
    </div>
    <h1 class="text-3xl font-bold uppercase tracking-widest text-gray-900">Boletim Escolar</h1>
    <p class="text-gray-500 font-bold">Ano Letivo 2025</p>
  </div>

  <div *ngIf="boletim; else loading">
    <div class="flex justify-between mb-8 text-sm uppercase bg-gray-50 p-4 border border-gray-200 rounded">
      <div>
        <p><span class="font-bold text-gray-600">Aluno:</span> <span class="text-lg ml-2">{{ boletim.aluno_nome }}</span></p>
        <p><span class="font-bold text-gray-600">NÂº BI:</span> <span class="ml-2">{{ boletim.aluno_bi || '---' }}</span></p>
      </div>
      <div class="text-right">
        <p><span class="font-bold text-gray-600">Turma:</span> <span class="ml-2">{{ boletim.turma }}</span></p>
        <p><span class="font-bold text-gray-600">EmissÃ£o:</span> <span class="ml-2">{{ dataHoje | date:'dd/MM/yyyy' }}</span></p>
      </div>
    </div>

    <table class="w-full border-collapse border border-black text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="border border-black p-3 text-left w-1/3 uppercase">Disciplina</th>
          <th class="border border-black p-3 text-center w-1/6">1Âº Tri</th>
          <th class="border border-black p-3 text-center w-1/6">2Âº Tri</th>
          <th class="border border-black p-3 text-center w-1/6">3Âº Tri</th>
          <th class="border border-black p-3 text-center w-1/6 bg-gray-200">MÃ©dia Final</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let linha of boletim.linhas">
          <td class="border border-black p-3 font-bold">{{ linha.disciplina }}</td>

          <td *ngFor="let trimestre of ['1Âº Trimestre', '2Âº Trimestre', '3Âº Trimestre']"
            class="border border-black p-3 text-center font-medium">
            <span [class.text-red-600]="getValorNota(linha.notas, trimestre) !== null && getValorNota(linha.notas, trimestre)! < 10"
                  [class.text-gray-400]="getValorNota(linha.notas, trimestre) === null">
              {{ getNota(linha.notas, trimestre) }}
            </span>
          </td>

          <td class="border border-black p-3 text-center font-bold bg-gray-50">
            <span [class.text-red-600]="linha.media_provisoria < 10"
                  [class.text-green-700]="linha.media_provisoria >= 10">
              {{ linha.media_provisoria | number:'1.1-1' }}
            </span>
          </td>
        </tr>

        <tr *ngIf="boletim.linhas.length" class="bg-gray-800 text-white print:bg-gray-200 print:text-black">
          <td class="border border-black p-3 font-bold uppercase">MÃ©dia Geral</td>
          <td colspan="3" class="border border-black p-3 text-center text-xs opacity-70">
            (Calculada com base nas disciplinas avaliadas)
          </td>
          <td class="border border-black p-3 text-center font-black text-lg">
            {{ calcularMediaGeral() | number:'1.1-1' }} v.
          </td>
        </tr>
      </tbody>
    </table>

    <div class="mt-20 pt-10 grid grid-cols-2 gap-16 text-center page-break-inside-avoid">
      <div>
        <div class="border-b border-black w-3/4 mx-auto mb-2"></div>
        <p class="text-xs font-bold uppercase text-gray-600">O Diretor de Turma</p>
      </div>
      <div>
        <div class="border-b border-black w-3/4 mx-auto mb-2"></div>
        <p class="text-xs font-bold uppercase text-gray-600">O Encarregado de EducaÃ§Ã£o</p>
      </div>
    </div>

    <div class="mt-12 flex justify-between items-center print:hidden border-t pt-6">
      <a routerLink="/lista-alunos" class="text-indigo-600 hover:text-indigo-800 font-bold">
        â† Voltar Ã  Lista
      </a>
      <button (click)="imprimir()"
        class="bg-indigo-900 text-white px-8 py-3 rounded-lg shadow-lg hover:bg-indigo-800 transition flex items-center gap-2 font-bold">
        ğŸ–¨ï¸ Imprimir Boletim PDF
      </button>
    </div>
  </div>

  <ng-template #loading>
    <div class="text-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-900 mx-auto mb-4"></div>
      <p class="text-gray-500">A processar notas acadÃ©micas...</p>
    </div>
  </ng-template>
</div>
